H2-3
sudo service sshd restart
ssh ubuntu@ip-osoite

kafka:
wget http://www.nic.funet.fi/pub/mirrors/apache.org/kafka/2.2.2/kafka_2.12-2.2.2.tgz
mv kafka_2.12-2.2.2 /var/lib/kafka
cd /var/lib/kafka
bin/kafka-server-start.sh config/server.properties

zookeeper:
apt-get update && apt install openjdk-11-jre-headless
bin/zookeeper-server-start.sh config/zookeeper-1.properties


kafka topic esimerkki:
bin/kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic ajoneuvot
bin/kafka-topics.sh --list --bootstrap-server localhost:9092
bin/kafka-console-producer.sh --broker-list localhost:9092 --topic ajoneuvot
bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic ajoneuvot --from-beginning


H4
A
sudo cp config/server.properties config/server-1.properties
sudo cp config/server.properties config/server-2.properties
sudo cp config/server.properties config/server-3.properties

sudo bin/zookeeper-server-start.sh config/zookeeper.properties
sudo bin/kafka-server-start.sh config/server-1.properties
sudo bin/kafka-server-start.sh config/server-2.properties
sudo bin/kafka-server-start.sh config/server-3.properties

bin/kafka-topics.sh -create -zookeeper localhost:3000 -replication-factor 3 -partitions 1 -topic tietokoneet
bin/kafka-topics.sh --describe --zookeeper localhost:3000 -topic tietokoneet

bin/kafka-console-producer.sh --broker-list localhost:9092,localhost:9093,localhost:9094 --topic tietokoneet
bin/kafka-console-consumer.sh --bootstrap-server localhost:9092,localhost:9093,localhost:9094 --from-beginning --topic tietokoneet --partition 0

bin/kafka-topics.sh -create -zookeeper localhost:3000 -replication-factor 3 -partitions 3 -topic fillarit
bin/kafka-topics.sh --describe --zookeeper localhost:3000 -topic fillarit

B
cp config/zookeeper.properties config/zookeeper-1.properties
cp config/zookeeper.properties config/zookeeper-2.properties
cp config/zookeeper.properties config/zookeeper-3.properties

mkdir -p data/zookeeper1
mkdir -p data/zookeeper2
mkdir -p data/zookeeper3

echo 1 > data/zookeeper1/myid
echo 2 > data/zookeeper2/myid
echo 3 > data/zookeeper3/myid

bin/zookeeper-server-start.sh config/zookeeper-1.properties
bin/zookeeper-server-start.sh config/zookeeper-2.properties
bin/zookeeper-server-start.sh config/zookeeper-3.properties

sudo bin/kafka-server-start.sh config/server-1.properties
sudo bin/kafka-server-start.sh config/server-2.properties
sudo bin/kafka-server-start.sh config/server-3.properties

bin/kafka-topics.sh -create -zookeeper localhost:3000,localhost:3001,localhost:3002 --replication-factor 3 -partitions 3 -topic failsafe

bin/kafka-console-producer.sh --broker-list localhost:9092,localhost:9093,localhost:9094 --topic failsafe
bin/kafka-console-consumer.sh --bootstrap-server localhost:9092,localhost:9093,localhost:9094 -topic failsafe --consumer-property group.id=group-red

C

var/lib/kafka/bin/start-cluster.sh
chmod 755 bin/start-cluster.sh

#!/bin/bash
/var/lib/kafka/bin/zookeeper-server-start.sh /var/lib/kafka/config/zookeeper-1.properties &
/var/lib/kafka/bin/zookeeper-server-start.sh /var/lib/kafka/config/zookeeper-2.properties &
/var/lib/kafka/bin/zookeeper-server-start.sh /var/lib/kafka/config/zookeeper-3.properties &
/var/lib/kafka/bin/kafka-server-start.sh /var/lib/kafka/config/server-1.properties &
/var/lib/kafka/bin/kafka-server-start.sh /var/lib/kafka/config/server-2.properties &
/var/lib/kafka/bin/kafka-server-start.sh /var/lib/kafka/config/server-3.properties &


bin/kafka-server-stop.sh
bin/zookeeper-server-stop.sh
bin/start-cluster.sh

netstat -an | grep LISTEN

5
bin/kafka-topics.sh --create --zookeeper localhost:3000 --replication-factor 3 --partitions 3 --topic streams-plaintext-input
bin/kafka-topics.sh --create --zookeeper localhost:3000 --replication-factor 3 --partitions 3 --topic streams-wordcount-output

data ja syöte:
wget http://hantt.pages.labranet.jamk.fi/bigdata/exercises/first_stream_document.txt
wget http://hantt.pages.labranet.jamk.fi/bigdata/exercises/second_stream_document.txt
cat first_stream_document.txt | bin/kafka-console-producer.sh --broker-list localhost:9092,localhost:9093,localhost:9094 --topic streams-plaintext-input

word count demo:
bin/kafka-run-class.sh org.apache.kafka.streams.examples.wordcount.WordCountDemo

bin/kafka-console-consumer.sh --bootstrap-server localhost:9092,localhost:9093,localhost:9094 --topic streams-wordcount-output --from-beginning --formatter kafka.tools.DefaultMessageFormatter --property print.key=true \
--property key.deserializer=org.apache.kafka.common.serialization.StringDeserializer \
--property value.deserializer=org.apache.kafka.common.serialization.LongDeserializer

6

192.168.1.15 kafka
192.168.1.19 master
192.168.1.6 slave1
192.168.1.17 slave2
192.168.1.33 slave3


tar xvf spark-2.4.7-bin-hadoop2.7.tgz
sudo mv spark-2.4.7-bin-hadoop2.7 /usr/local/spark

nano ~/.bashrc
export PATH=$PATH:/usr/local/spark/bin
source ~/.bashrc

export SPARK_MASTER_HOST='192.168.1.19'
export SPARK_LOCAL_UP='192.168.1.19'
export JAVA_HOME='/usr/lib/jvm/java-8-openjdk-amd64'
export PYSPARK_PYTHON='/usr/bin/python3'

käynnistä master:
./sbin/start-master.sh
käynnistä slave:
/usr/local/spark/sbin/start-slave.sh spark://192.168.1.19:7077
tsekki:
jps

putty tunnelointi ja tsekki selaimella http://localhost:8080/

